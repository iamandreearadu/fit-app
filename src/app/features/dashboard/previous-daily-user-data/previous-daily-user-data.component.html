<div class="previous-container">

  <h2 class="section-title">Previous Days</h2>

  <div class="week-nav" *ngIf="currentWeek() as week">
    <button
      class="change-week-btn"
      mat-stroked-button
      (click)="prevWeek()"
      [disabled]="currentWeekIndex() === weeks().length - 1">
      <mat-icon>chevron_left</mat-icon>
      Previous week
    </button>

    <span class="week-label">
      {{ week.start | date:'dd MMM' }} â€“ {{ week.end | date:'dd MMM yyyy' }}
    </span>

    <button
      class="change-week-btn"
      mat-stroked-button
      (click)="nextWeek()"
      [disabled]="currentWeekIndex() === 0">
      Next week
      <mat-icon>chevron_right</mat-icon>
    </button>
  </div>

  <div class="timeline" *ngIf="currentWeek() as week">
    <ng-container *ngFor="let d of week.days">
      <div class="timeline-item" (click)="openDay(d)">
        <mat-card class="day-card" appearance="outlined">
          <mat-card-content>
            <div class="day-header">
              <span class="day-date">{{ d.date | date:'EEEE, dd MMM yyyy' }}</span>
              <mat-icon class="arrow">chevron_right</mat-icon>
            </div>

            <div class="day-meta">
              <div class="meta-item">
                <mat-icon>directions_walk</mat-icon>
                <span>{{ d.steps || 0 }}</span>
              </div>

              <div class="meta-item">
                <mat-icon>local_fire_department</mat-icon>
                <span>{{ d.caloriesTotal || 0 }}</span>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </ng-container>
  </div>

</div>

<div *ngIf="showModal && selectedDay" class="modal-backdrop" (click)="closeModal()">
  <mat-card class="modal-card" (click)="$event.stopPropagation()">

    <mat-card-header>
      <mat-card-title class="modal-title">
        {{ selectedDay.date | date:'dd MMM yyyy' }}
      </mat-card-title>
    </mat-card-header>

    <mat-card-content class="modal-content">

      <div class="stats-grid">
        <div class="stat">
          <div class="label">Steps</div>
          <div class="value">{{ selectedDay.steps || 0 }}</div>
        </div>

             <div class="stat">
          <div class="label">Water Consumed</div>
          <div class="value">{{ selectedDay.waterConsumedL || 0 }}<span class="unit"> L</span></div>
        </div>

        <div class="stat">
          <div class="label">Activity</div>
         <div class="value value-text">{{ resolveActivityLabel(selectedDay.activityType) }}</div>
        </div>


        <div class="stat">
          <div class="label">Calories Intake</div>
          <div class="value">{{ selectedDay.caloriesIntake || 0 }}<span class="unit"> kcal</span></div>
        </div>

        <div class="stat">
          <div class="label">Calories Burned</div>
          <div class="value">{{ selectedDay.caloriesBurned || 0 }}<span class="unit"> kcal</span></div>
        </div>

        <div class="stat">
          <div class="label">Net Calories</div>
          <div class="value">{{ selectedDay.caloriesTotal || 0 }}<span class="unit"> kcal</span></div>
        </div>

   
        <ng-container *ngIf="selectedDay.macrosPct as m">
    <div class="stat">
  <div class="label">Protein</div>
  <div class="value">{{ (m.protein) | number:'1.0-0' }}<span class="unit"> g</span></div>
</div>
<div class="stat">
  <div class="label">Carbs</div>
  <div class="value">{{ (m.carbs)   | number:'1.0-0' }}<span class="unit"> g</span></div>
</div>
<div class="stat">
  <div class="label">Fats</div>
  <div class="value">{{ (m.fats)    | number:'1.0-0' }}<span class="unit"> g</span></div>
</div>
        </ng-container>
      </div>

    </mat-card-content>

    <mat-card-actions align="end">
      <button mat-stroked-button color="accent" class="close-btn" (click)="closeModal()">
        <mat-icon>close</mat-icon>
        Close
      </button>
    </mat-card-actions>

  </mat-card>
</div>
