<div class="container py-4">
  <!-- <h2 class="mb-3">Daily User Data</h2> -->

  <!-- LOADING -->
  <div *ngIf="loading()" class="alert alert-info">
    Loading…
  </div>
  {{form.value.date}} - {{ todayDate }}
  <ng-container *ngIf="!loading()">
    <form [formGroup]="form" novalidate>

      <!-- TOP ROW: TODAY / CALORIES / WATER & STEPS -->
      <div class="row g-3">

        <!-- TODAY CARD -->
        <div class="col-md-4">
          <div class="card h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h5 class="card-title mb-0">Today</h5>
                <span class="badge bg-secondary">
                  {{ form.get('date')?.value  }}
                </span>
              </div>

              <div class="mb-3">
                <label class="form-label">Date</label>
                <input
                  formControlName="date"
                  type="date"
                  class="form-control"
                />
              </div>

              <div>
                <label class="form-label">Activity Type</label>
                <select class="form-select" formControlName="activityType">
                  <option value="strength-training">Strength Training</option>
                  <option value="cardio">Cardio</option>
                  <option value="hiit-training">HIIT Training</option>
                  <option value="active-rest-day">Active Rest Day</option>
                  <option value="rest-day">Rest Day</option>
                </select>
              </div>

              <small class="text-muted d-block mt-2">
                Choose what kind of day this is so you can better track your habits.
              </small>

                 <div class="d-flex justify-content-between align-items-center mb-1">
        <span class="text-muted">Calories burned</span>
        <span class="fw-semibold">{{ caloriesBurned() }} kcal</span>
      </div>

      <div class="input-group input-group-sm mb-2">
        <input
          type="number"
          min="0"
          class="form-control"
          formControlName="caloriesBurned"
          placeholder="Enter burned kcal"
        />
        <button
          type="button"
          class="btn btn-outline-primary"
          (click)="adjustCaloriesBurned(200)">
          +200
        </button>
        <button
          type="button"
          class="btn btn-outline-secondary"
          (click)="adjustCaloriesBurned(-200)">
          −200
        </button>
      </div>

           <div class="mt-2">
        <span class="fw-semibold">Net calories:</span>
        <span
          [ngClass]="{
            'text-success': netCalories() < totalCalories(),
            'text-danger': netCalories() > totalCalories()
          }">
          {{ netCalories() }} kcal
        </span>
      </div>

            </div>
          </div>
        </div>

        <!-- CALORIES & MACROS CARD -->
        <div class="col-md-4">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title mb-2">Calories & Macros</h5>

              <p class="mb-1 text-muted">Estimated calories for today</p>
              <p class="display-6 mb-2">{{ totalCalories() }} kcal</p>


              <fieldset formGroupName="macrosPct">
                <div class="mb-2">
                  <label class="form-label">Protein (g)</label>
                  <input
                    formControlName="protein"
                    type="number"
                    class="form-control"
                    min="0"
                  />
                </div>

                <div class="mb-2">
                  <label class="form-label">Carbs (g)</label>
                  <input
                    formControlName="carbs"
                    type="number"
                    class="form-control"
                    min="0"
                  />
                </div>

                <div class="mb-2">
                  <label class="form-label">Fats (g)</label>
                  <input
                    formControlName="fats"
                    type="number"
                    class="form-control"
                    min="0"
                  />
                </div>
              </fieldset>


            </div>
          </div>
        </div>

        <!-- WATER & STEPS CARD -->
        <div class="col-md-4">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title mb-2">Water & Steps</h5>

              <!-- WATER -->
              <p class="mb-1">
                <strong>{{ waterConsumedL() }} L</strong>
                <span class="text-muted ms-1">
                  / {{ waterTargetFromMetrics }} L (target)
                </span>
              </p>
              <div class="progress mb-2">
                <div
                  class="progress-bar bg-info"
                  role="progressbar"
                  [style.width.%]="waterProgress()"
                  aria-valuemin="0"
                  aria-valuemax="100">
                </div>
              </div>

              <div class="d-flex flex-wrap gap-2 mb-3">
                <button
                  type="button"
                  class="btn btn-outline-primary btn-sm"
                  (click)="addWater(0.25)">
                  + 250 ml
                </button>
                <button
                  type="button"
                  class="btn btn-outline-primary btn-sm"
                  (click)="addWater(0.5)">
                  + 500 ml
                </button>
                <button
                  type="button"
                  class="btn btn-outline-secondary btn-sm"
                  (click)="addWater(-0.25)">
                  − 250 ml
                </button>
              </div>

              <!-- STEPS -->
              <p class="mb-1">
                <strong>{{ steps() }}</strong>
                <span class="text-muted"> / {{ stepTarget()}} steps</span>
              </p>
              <div class="progress mb-2">
                <div
                  class="progress-bar"
                  role="progressbar"
                  [style.width.%]="stepsProgress()"
                  aria-valuemin="0"
                  aria-valuemax="100">
                </div>
              </div>

              <div class="d-flex flex-wrap gap-2">
                <button
                  type="button"
                  class="btn btn-outline-primary btn-sm"
                  (click)="addSteps(500)">
                  + 500
                </button>
                <button
                  type="button"
                  class="btn btn-outline-primary btn-sm"
                  (click)="addSteps(1000)">
                  + 1000
                </button>
                <button
                  type="button"
                  class="btn btn-outline-secondary btn-sm"
                  (click)="addSteps(-500)">
                  − 500
                </button>
              </div>

            </div>
          </div>
        </div>

      </div>

      <!-- ACTIONS -->
      <div class="row g-3 mt-3">
        <div class="col-12 d-flex gap-2">
          <button
            type="button"
            class="btn btn-primary"
            [disabled]="form.value.date != todayDate"
            (click)="saveDailyData()">
            Save
          </button>
          <button
            type="button"
            class="btn btn-secondary"
            (click)="reset()">
            Reset
          </button>
        </div>
      </div>

    </form>
  </ng-container>
</div>
