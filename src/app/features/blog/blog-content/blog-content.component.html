<div *ngIf="loading" class="text-center p-4">Loading…</div>

<div *ngIf="!loading" class="container py-3">
	<div class="row mb-5 align-items-center">
		<div class="col-md-4 mb-2">
			<div class="input-group">
				<span class="input-group-text"><i class="bi bi-search"></i></span>
				<input class="form-control" placeholder="Caută în titlu, subtitlu sau descriere" [(ngModel)]="searchTerm" (ngModelChange)="applyFilters()" />
			</div>
		</div>
		<div class="col-md-5 mb-2">
			<select class="form-select" [(ngModel)]="selectedCategory" (change)="applyFilters()">
				<option value="all">Toate categoriile</option>
				<option *ngFor="let c of categories" [value]="c">{{ c }}</option>
			</select>
		</div>
			<div class="col-md-3 text-md-end mb-2">
				<button *ngIf="isOwner" class="btn btn-dark me-2" (click)="openCreate()">Crează post nou</button>
			</div>
	</div>

	<div class="row g-3">
			<div class="col-12">
				<div class="row g-3">
					<div *ngFor="let p of filtered" class="col-sm-12 col-md-6 col-lg-4">
						<div class="card post-card h-100 shadow-sm">
							<div class="card-img-top img-holder" [style.background-image]="'url(' + (p.image || 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?q=80') + ')'"></div>
							<div class="card-body d-flex flex-column">
								<h5 class="card-title mb-1">{{ p.title }}</h5>
								<p class="card-text text-light small mb-2">{{ p.caption }}</p>
								<div class="mt-auto d-flex justify-content-between align-items-center">
									<span class="badge bg-secondary">{{ p.category }}</span>
									<div>
										<button class="btn btn-sm btn-outline-light me-1" (click)="post = p">Vezi</button>
										<button *ngIf="isOwner" class="btn btn-sm btn-primary" (click)="openEdit(p)">Edit</button>
										<button *ngIf="isOwner" class="btn btn-sm btn-warn" (click)="deletePost()">Del</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div *ngIf="filtered.length === 0" class="text-center text-muted mt-4">Niciun rezultat</div>
			</div>

		<div class="col-lg-6">
			<div *ngIf="editing && !showCreateOverlay" class="card p-3 mb-3">
				<h5 class="card-title">{{ editModel.id ? 'Editează post' : 'Creează post' }}</h5>
				<div class="mb-2">
					<input class="form-control" placeholder="Titlu" [(ngModel)]="editModel.title" />
				</div>
				<div class="mb-2">
					<input class="form-control" placeholder="Subtitlu" [(ngModel)]="editModel.caption" />
				</div>
				<div class="mb-2">
					<input class="form-control" placeholder="Categorie" [(ngModel)]="editModel.category" />
				</div>
				<div class="mb-2">
					<input class="form-control" placeholder="URL imagine" [(ngModel)]="editModel.image" />
				</div>
				<div class="mb-2">
					<textarea class="form-control" rows="5" placeholder="Descriere" [(ngModel)]="editModel.description"></textarea>
				</div>
				<div class="d-flex justify-content-end">
					<button class="btn btn-secondary me-2" (click)="cancelEdit()">Anulează</button>
					<button class="btn btn-primary" (click)="createOrUpdatePost()">Salvează</button>
				</div>
			</div>

			<div *ngIf="post && !editing && !showCreateOverlay" class="card bg-dark border-secondary h-100 text-white">
				<img [src]="post.image || 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?q=80'" class="card-img-top post-img" alt="thumbnail" />
				<div class="card-body">
					<h4 class="card-title">{{ post.title }}</h4>
					<h6 class="card-subtitle mb-2 text-muted">{{ post.caption }}</h6>
					<p class="text-light">{{ post.description }}</p>
					<span class="badge bg-secondary">{{ post.category }}</span>
				</div>
			</div>

			<!-- <div *ngIf="!post && !editing && !showCreateOverlay" class="card p-4 text-center">
				<p class="mb-3">Niciun post selectat.</p>
				<button class="btn btn-primary" (click)="createSample()">Creează post de probă</button>
				</div> -->
		</div>
	</div>

		<!-- overlay create/edit card -->
		<div *ngIf="showCreateOverlay" class="overlay-backdrop d-flex align-items-center justify-content-center">
				<div class="card overlay-card shadow-lg p-3">
					<h5 class="mb-3">{{ editModel.id ? 'Editează post' : 'Creează post' }}</h5>
				<div class="mb-2">
					<input class="form-control" placeholder="Titlu" [(ngModel)]="editModel.title" />
				</div>
				<div class="mb-2">
					<input class="form-control" placeholder="Subtitlu" [(ngModel)]="editModel.caption" />
				</div>
				<div class="mb-2">
					<input class="form-control" placeholder="Categorie" [(ngModel)]="editModel.category" />
				</div>
				<div class="mb-2">
					<input class="form-control" placeholder="URL imagine" [(ngModel)]="editModel.image" />
				</div>
				<div class="mb-2">
					<textarea class="form-control" rows="6" placeholder="Descriere" [(ngModel)]="editModel.description"></textarea>
				</div>
				<div class="d-flex justify-content-end">
					<button class="btn btn-outline-secondary me-2" (click)="showCreateOverlay=false">Anulează</button>
					<button class="btn btn-primary" (click)="createOrUpdatePost()">Salvează</button>
				</div>
			</div>
		</div>
</div>